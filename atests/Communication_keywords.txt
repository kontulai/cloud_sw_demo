*** Settings ***
Library           Rammbock
Library           OperatingSystem

*** Variables ***
${READ AMOUNT MESSAGE CODE}    3

*** Keywords ***
Create client and connect to bonk server
    Create Tcp Client
    Client Connects To Tcp Server    127.0.0.1    55555

Disconnect from bonkserver and delete client
    Delete Client

Server Has ${amount} bonks
    write db    ${amount}

Server should have ${amount} bonks
    ${server amount}=    read db
    should be equal    ${server amount}    ${amount}

Client sends get amount of bonks request
    Reset Message
    Add Integer As Octets    ${READ AMOUNT MESSAGE CODE}    1
    Add Integer As Octets    0    1

client sends increase bonks message with ${amount} as amount of bonks
    Reset message
    Add Integer As Octets    1    1

client sends decrease bonks message with ${amount} as amount of bonks
    Reset message
    Add Integer As Octets    1    1

Client receives response with ${amount} as amount of bonks
    Client Receives Data
    ${message code}=    Read Integer From Octets    1
    ${received amount}=    Read Integer From Octets    1
    Should be equal    ${amount}    ${received amount}

Start bonkserver
    start

Stop bonkserver
    stop

Increase amount of bonks and check result from server
    [Arguments]    ${initial amount}    ${increment}    ${status}    ${final amount}
    Given server has ${initial amount} bonks
    When client sends increase bonks message with ${amount} as amount of bonks
    Then client receives response with ${final amount} as amount of bonks

Decrease amount of bonks and check result from server
    [Arguments]    ${initial amount}    ${decrement}    ${status}    ${final amount}
    Given server has ${initial amount} bonks
    client sends decrease bonks message with ${decrement} as amount of bonks
    Client receives response with ${final amount} as amount of bonks

